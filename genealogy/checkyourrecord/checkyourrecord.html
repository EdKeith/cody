<!-- saved from url=(0022)http://internet.e-mail -->
<html>
<head>
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<meta name="Author" CONTENT="allancody@rcn.com">
<meta name="Description" content="Cody Family Record Lookup">
<meta name="Keywords" content="">
<title>International Cody Family Association</title>
<link rel="stylesheet" href="../../css222.css" />
<script type="text/javascript" src="../../dynamictext22.js"></script>
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<link rel="stylesheet" href="css/checkyourrecord.css" >

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type='text/javascript'>
	function isEmail(email) {
	  var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	  return regex.test(email);
	}
	var bgcolors = {"5":"#F8E088","6":"#F8E498","7":"#F8E8A8","8":"#F8EBB8","9":"#F8EEC8","10":"#F8F0D8","11":"#F8F0E8","12":"#F8F0F8","13":"#F8F0FF"};
</script>

<link rel="stylesheet" href="css/checkyourrecord.css" >
	
</head>

<body bgcolor="#ffffff">



<table width="900" border="0" cellspacing="0" cellpadding="0" align="center">
  <tr>
  <td rowspan="2" align="left" valign="top" width="300" height="400" style="background: url(../../crest.jpg);
      background-repeat: no-repeat; background-color: white;  background-position: 0 0">
<div id="showcase" style="visibility: hidden; background: url(../../giftshop/itemgenealogy2013.jpg); background-repeat: no-repeat;">
<center>
<div class="showcasetitle"></div>
<div class="showcasecaption" style="position: relative; width: 300px; top: 350px; left: 0px; text-align: justify;"></div>
</center>
</td>
<td align="center" colspan="2" valign="top" height="105">
<div id="masthead"><img style="visibility: visible; opacity: 0.99999;" src="../../logoon.jpg" alt="the logo" id="thelogo"
width="600" height="99"></div>
<hr noshade height=2 width=80%>
</td>
</tr>
<tr>
<td colspan="2" height="300" width="600" align="center" valign="top">
<div class="title">CHECK YOUR RECORD</div>
<div class="contenttext" style="margin-left: 15px;">
	Now, you can check and correct your records in our ICFA Genealogy!
	<br><br>
	This feature automatically retrieves a record from our 2013 Genealogy
	for your examination and correction. These corrections go to our Genealogist,
	who will examine them and forward valid corrections to the Book Committee
	who reviews them for the Database Manager.
	<br><br>
	All updates through May are complete, future updates will appear in within 6 weeks of submission.
	<br><br>
	Enter your Cody ID, then click the 'Search by Cody ID' button.
</div>

<form id="codyidform" name="codyidform" class="contenttext">
	<input class="textbox chapterid" type="text" name="chapterid" id="chapterid" maxlength="3" value="" />/
	<input class="textbox year" type="text" name="chaptermemberid" id="chaptermemberid" maxlength="12" value="" />
	<input id="searchbycodyid" class="button" type="submit" name="Submit" value="Search by Cody ID">
	<span id="searchbycodyid-message" class="user-message"></span>
</form>

</td>
</tr>
<tr><td colspan=3>


<div class="contenttext">If you don't know your Cody ID, enter your first and last names, plus a birth year, then click the
'Search by Name and Birth Year' button. Remember, descendants are usually listed by their birth name.</div>

    <form id="nameform" name="nameform">
		<div id="nameform-table">
            <div class="nameform-div">
				<label id="firstnamereq" class="required">First Name</label>
				<input class="textbox required name name-or-place" type="text" name="first-name" id="first-name"  style="width:120px;" />
			</div>
            <div class="nameform-div">
				<label id="lastnamereq" class="required">Last Name</label>
				<input class="textbox required name name-or-place" type="text" name="last-name" id="last-name" style="width:150px;" />
            </div>
			<div class="nameform-div">
				<label id="lastnamereq" class="required">Birth Year</label>
				<input class="textbox required number" type="text" name="birth-year" id="birth-year"  maxlength="4" value="" style="width:80px;" />
            </div>
			<div class="nameform-div">
			    <input id="searchbyname" name="searchbyname" class="button" type="submit" value="Search by Name and Birth Year" />
            </div>
			<div class="nameform-div">
				<span id="searchbyname-message" class="user-message"></span>
            </div>
		</div>
	</form>
	    <!-- this is the target for the data -->
		<div id="family-info"></div>

		<!-- TEMPLATE FOR THE EDIT WINDOW (not shown initially, until an edit -->
		<div id="edit-window" class="edit-window">
			<form id="edit-form" name="edit-form" class="edit-form">
				<table id="edit-table" class="edit-table" border="0">
				<tbody>
				<tr class="editrow">
					<td colspan="6">
					    <div id="edit-window-header" class="edit-window-header">
					        <div class="edit-window-header-row">
								Cody ID:<span id="codyidspan" class="codyidspan"></span>
								<input id="editsubmit" name="editsubmit" type="submit" class="button" value="Submit"/>
								<input id="editcancel" name="editcancel" type="button" class="button" value="Cancel" />
								<input id="addamarriage" name="addamarriage" type="button" class="button" value="Add a marriage" />
						     </div>
					        <div class="edit-window-header-row">
								<label id="must-include-message">Please enter any corrections or additions, and you must include your name and email</label>
							</div>
					        <div class="edit-window-header-row">
							    <table style="width:100%"><tr>
								<td>
									<label class="required">First name</label><br/ >
									<input id="submitter-first-name" name="submitter-first-name" class="textbox name name-or-place" type="text" value="" />
								</td>
								<td>
									<label class="required">Last name</label><br/ >
									<input id="submitter-last-name" name="submitter-last-name" class="textbox name name-or-place" type="text" value="" />
								</td><td>
									<label>Cody ID (if known) </label><br/ >
									<input id="submitter-cody-id" name="submitter-cody-id" type="text" class="textbox" />
								</td>
								<td>
									<label class="required">Email</label><br/ >
									<input id="submitter-email" name="submitter-email" class="textbox email" type="text" value=""/>
								</td>
								</tr></table>
							</div>
					    </div>
					</td>
				</tr>
				<tr class="edit-row">
					<td><label class="row-header">Name</label></td>
					<td class="edit-field">
						<label>First</label><br>
						<input id="first-name" name="first-name" class="textbox name name-or-place" type="text"  />
					</td>
					<td class="edit-field">
						<label>Middle</label><br>
						<input id="middle-name" name="middle-name" class="textbox name name-or-place" type="text"  />
					</td>
					<td class="edit-field">
						<label>Surname</label><br>
						<input id="last-name" name="last-name" class="textbox name name-or-place"  type="text" />
					</td>
					<td class="edit-field">
						<label>Suffix</label><br>
						<input id="suffix" name="suffix" class="textbox suffix name-or-place" type="text" />
					</td>
					<td></td>
				</tr>
				<tr id="edit-birth-row" class="edit-row">
				    <td><label class="row-header">Birth</label></td>
					<td class="edit-field">
					    <label>Month</label><br>
						<select id="birth-month" name="birth-month" class="month"><option value="">(unknown)</option>
							<option value="1">January</option><option value="2">February</option><option value="3">March</option>
							<option value="4">April</option><option value="5">May</option><option value="6">June</option>
							<option value="7">July</option><option value="8">August</option><option value="9">September</option>
							<option value="10">October</option><option value="11">November</option><option value="12">December</option>
						</select>
					</td>
					<td class="edit-field">
						<label>Day</label><br>
						<input id="birth-day" class="textbox day number" maxlength="2" name="birth-day" type="text" />
					</td>
					<td class="edit-field">
						<label>Year</label><br>
						<input id="birth-year" class="textbox year number " maxlength="4" name="birth-year" type="text" />
					</td>
					<td class="edit-field">
						<label>Town</label><br>
						<input id="birth-town" class="textbox town name-or-place " maxlength="40"  name="birth-town" type="text" />
					</td>
					<td class="edit-field">
						<label>State, Province or Region</label><br />
						<input id="birth-region" class="textbox region name-or-place" maxlength="40"  name="birth-region" type="text" />
					</td>
				</tr>

				<tr id="deathrow" class="edit-row">
				    <td><label class="row-header">Died</label>
					</td>
					<td class="edit-field">
						<select id="death-month" name="death-month" class="month"><option value="">(unknown)</option>
							<option value="1">January</option><option value="2">February</option><option value="3">March</option>
							<option value="4">April</option><option value="5">May</option><option value="6">June</option>
							<option value="7">July</option><option value="8">August</option><option value="9">September</option>
							<option value="10">October</option><option value="11">November</option><option value="12">December</option>
						</select>
					</td>
					<td class="edit-field">
						<input id="death-day" class="textbox day number" maxlength="2"  name="death-day" type="text" />
					</td>
					<td class="edit-field">
						<input id="death-year" class="textbox year number" maxlength="4"  name="death-year" type="text" />
					</td>
					<td class="edit-field">
						<input id="death-town" class="textbox town name-or-place" maxlength="40"  name="death-town" type="text" />
					</td>
					<td class="edit-field">
						<input id="death-region" class="textbox region name-or-place" maxlength="40"  name="death-region" type="text" />
				    </td>
				</tr>
				<tr id="burialinfo" class="edit-row">
					<td colspan="2">
						<label class="row-header">Buried</label>
					</td>
					<td class="edit-field"  style="text-align:right">

					</td>
					<td colspan="2" class="edit-field">
					    <label>Cemetery and/or Town</label><br />
						<input id="burial-town" class="textbox cemetery" maxlength="100"  name="burial-town" type="text" />
					</td>
					<td class="edit-field">
						<label>State, Province or Region</label><br />
						<input id="burial-region" class="textbox region name-or-place" maxlength="40"  name="burial-region" type="text" />
					</td>
				</tr>


				<tr id="editmarriages">
					<td id="editmarriagescell" colspan="6"></td>
				</tr>
				<tr id="aretheymarriedrow" class="edit-row">
					<td colspan="6">
					</td>
				</tr>

				<tr id="comment-row"><td colspan="6" style="padding:5px;">
				    <label class="row-header">Please add any comments, explanations, or further elaborations</label>
					<textarea name="comment" id="comment" class="comment-textarea" ></textarea>
				</td>
				</tr>
				</tbody>
				</table>
			</form>
		</div>
<!--
		<form id="contactform" name="contactform">
			<div class="formrow">
				<label style="font-weight: bold;">Email	</label>
				<input class="textbox" type="text" name="email" id="email" />
				<input id="contactbutton" class="button" type="submit" name="contactbutton" value="Contact">
			</div>
			<div class="formrow">Anything you'd like to say?.</div>
			<div class="formrow">
				<textarea id="myupdate" name="myupdate" cols="70" rows="7" maxlength="2000" onkeyup="return ismaxlength(this)">Use this space to tell us what's new: up to 2000 characters.
				</textarea>
			</div>
		</form>
-->
 <div class="contenttext">
<a href="http://www.cody-family.org/membership/joinus/joinus.php" target="any_window" title="Click for our New Membership Application!">
Can't find your record? Join us and find yourself!
</a>
<br><br>
</div>
	</td>
</tr>
<tr><td colspan="3"><hr noshade align=center height=2 width=80%></div></td></tr>
<tr>
<td width=300><div class="footertextl">COPYRIGHT � JUNE, 2017 BY</div>
</td>
<td width=300 align=center><img src="../../footerlogo.gif" alt="The International Cody Family Association" width="245"
  height="40"><br>
<div class="footertext"><br>WEBSITE BY WEBMASTER@CODY-FAMILY.ORG</div>
</td>
<td width=300><div class="footertextr">ALL RIGHTS RESERVED.</div>
</td>
</tr>
</table>


<!-- THIS IS A HIDDEN TEMPLATE FOR MARRIAGE EDITING, AND IS NOT SHOWN, only copies are shown -->
<table id="edit-marriage-table" class="edit-marriage-table">
<tbody>
	<tr class="edit-marriage-row">
		 <td id="editmarriage-title-cell" class="marriage-title-cell" colspan="7"></td>
	</tr>
	<tr id="editspouserow" class="edit-sub-row">
		<td style="width:100px">
			<label class="row-header">Spouse Name</label>
		</td>
		<td class="edit-field">
			<label>First</label><br>
			<input id="first-name" name="first-name" class="textbox name name-or-place" />
		</td>
		<td class="edit-field">
			<label for="middle-name">Middle</label><br>
			<input id="middle-name" name="middle-name" class="textbox name name-or-place" />
		</td>
		<td class="edit-field">
			<label>Surname</label><br>
			<input id="last-name" name="last-name" class="textbox name name-or-place" />
		</td>
		<td class="edit-field">
			<label>Suffix</label><br>
			<input id="suffix" name="suffix" class="textbox name name-or-place" />
		</td>
		<td class="edit-field">
			<input type="checkbox" name="divorced" id="divorced" value="" />
			<label>Divorced</label>

		</td>
	</tr>
	<tr id="edit-marriage-row" class="edit-marriage-row">
		<td><label class="row-header">Wedding</label></td>
		<td class="edit-field">
			<label>Month</label><br>
			<select id="wedding-month" name="wedding-month" class="month"><option value=""></option>
				<option value="1">January</option><option value="2">February</option><option value="3">March</option>
				<option value="4">April</option><option value="5">May</option><option value="6">June</option>
				<option value="7">July</option><option value="8">August</option><option value="9">September</option>
				<option value="10">October</option><option value="11">November</option><option value="12">December</option>
			</select>
		</td>
		<td class="edit-field">
			<label>Day</label><br>
			<input id="wedding-day" class="textbox day number" maxlength="2" name="wedding-day" type="text" />
		</td>
		<td class="edit-field">
			<label>Year</label><br>
			<input id="wedding-year" class="textbox year number" maxlength="4" name="wedding-year" type="text" />
		</td>
		<td class="edit-field">
			<label>Town</label><br>
			<input id="wedding-town" class="textbox town name name-or-place" maxlength="40"  name="wedding-town" type="text" />
		</td>
		<td class="edit-field">
			<label>State, Province or Region</label><br>
			<input id="wedding-region" class="textbox region name name-or-place" maxlength="40"  name="wedding-region" type="text" />
		</td>
	</tr>

	<tr id="spousebirthrow" class="edit-sub-row">
		<td><label class="row-header row-sub-header">Birth</label></td>
		<td class="edit-field">
			<select id="birth-month" name="birth-month" class="month"><option value=""></option>
				<option value="1">January</option><option value="2">February</option><option value="3">March</option>
				<option value="4">April</option><option value="5">May</option><option value="6">June</option>
				<option value="7">July</option><option value="8">August</option><option value="9">September</option>
				<option value="10">October</option><option value="11">November</option><option value="12">December</option>
			</select>
		</td><td class="edit-field">
			<input id="birth-day" class="textbox day number" maxlength="2" name="birth-day" type="text" />
		</td><td>
			<input id="birth-year" class="textbox year number" maxlength="4" name="birth-year" type="text" />
		</td><td class="edit-field">
			<input id="birth-town" class="textbox town name name-or-place" maxlength="40"  name="birth-town" type="text" />
		</td><td class="edit-field">
			<input id="birth-region" class="textbox region name name-or-place" maxlength="40"  name="birth-region" type="text" />
		</td>
	</tr>

	<tr id="editspousedeathrow" class="edit-sub-row">
		<td><label class="row-header row-sub-header">Died</label></td>
		<td class="edit-field">
			<select id="death-month" name="death-month" class="month"><option value=""></option>
				<option value="1">January</option><option value="2">February</option><option value="3">March</option>
				<option value="4">April</option><option value="5">May</option><option value="6">June</option>
				<option value="7">July</option><option value="8">August</option><option value="9">September</option>
				<option value="10">October</option><option value="11">November</option><option value="12">December</option>
			</select>
		</td>
		<td class="edit-field">
			<input id="death-day" class="textbox day number" maxlength="2"  name="death-day" type="text" />
		</td>
		<td class="edit-field">
			<input id="death-year" class="textbox year number" maxlength="4"  name="death-year" type="text" />
		</td>
		<td class="edit-field">
			<input id="death-town" class="textbox town name-or-place" maxlength="40"  name="death-town" type="text" />
		</td>
		<td class="edit-field">
			<input id="death-region" class="textbox region name-or-place " maxlength="40"  name="death-region" type="text" />
		</td>
	</tr>
	<tr id="spouseburial" class="edit-sub-row">
		<td colspan="2" ><label class="row-header row-sub-header">Buried</label></td>
		<td class="edit-field" style="text-align:right">

		</td>
		<td colspan="2" class="edit-field">
		    <label>Cemetery and/or Town</label><br />
			<input id="burial-town" class="textbox cemetery" maxlength="100"  name="burial-town" type="text" />
		</td>
		<td class="edit-field">
			<label>State, Province or Region</label><br />
			<input id="burial-region" class="textbox region name-or-place" maxlength="40"  name="burial-region" type="text" />
		</td>

	</tr>
</tbody>
</table>
<!-- END OF MARRIAGE EDIT WINDOW TEMPLATE -->


<script type="text/javascript">
    /*    SEARCH BY CODY ID  */
    $(document).ready(function() {
		$("#codyidform").submit(function(event) {
			event.preventDefault();
		    var chapterId = $("#chapterid").val().trim();
			var chaptermemberId = $("#chaptermemberid").val().trim();
			if(chapterId.length != 3) {
			    if(chapterId == "94") {chapterId = "094"; $("#chapterid").val("094");}
			    else if(chapterId == "99") {chapterId = "099"; $("#chapterid").val("099"); }
				else {
					$("#searchbycodyid-message").html("Please use valid Cody Id");
					return false;
				}
			}
			$("#searchbycodyid").prop('disabled',true);
			$("#searchbycodyid-message").html("Searching...");

 			$.ajax( {url:'../cfo/pfd/swi.php',
					type: "POST",
					data: {action:'getbycodyid', chapterid:chapterId, chaptermemberid:chaptermemberId}
				})
				.done(function(data){
				    $("#searchbycodyid-message").empty();
				    if(data === false) {
						$("#searchbycodyid-message").html("The Cody ID was not found");
					}
					else {
						$("#searchbycodyid-message").empty();
						$("#family-info").empty().show();
						var personData = $.parseJSON(data);
						if(personData) {
							loadPerson(personData,1);
						}
						else {
						   $("#searchbycodyid-message").html("The Cody ID was not found");
						}
					}
				})
				.fail(function (jqXHR, textStatus, errorThrown) {
					$("#searchbycodyid-message").html("The Cody ID was not found");
				})
				.always(function() {
					$("#searchbycodyid").prop('disabled',false);
				});
		});
	});
</script>
<script type="text/javascript">
    /*    SEARCH BY FIRST NAME, LAST NAME AND BIRTH YEAR  */
    $(document).ready(function() {
		$("#nameform").submit(function(event) {
			event.preventDefault();
			var firstname = $("#first-name").val().trim();
			var lastname = $("#last-name").val().trim();
			var birthyear = $("#birth-year").val().trim();

            if(firstname.length == 0 || lastname.length == 0 || birthyear.length != 4) {
			    $("#searchbyname-message").html("Please include first and last name and birth year");
				$("#required_message").css("color","red").css("font-weight","bold");
				return false;
			}

			$("#searchbyname").prop('disabled',true);
			$("#searchbyname-message").html("Searching...");

			$.ajax( {url:'../cfo/pfd/swi.php',
					type: "POST",
					data: {action:'getbyname', firstname:firstname, lastname:lastname,birthyear:birthyear}
				})
				.done(function(data){
				    $("#searchbyname-message").empty();
					var parsedJson = $.parseJSON(data);
					var count = Object.keys(parsedJson).length;
					if(count == 0) {
					    var msg = "There are no records in our genealogy for "+firstname+" "+lastname+" born in "+birthyear;
						$("#searchbyname-message").html(msg);
					}
					else if(count == 1) {
					    $("#family-info").empty().show();
						$.each(parsedJson, function (codyid,personData) {
							loadPerson(personData,1);
						});
					}
					else if(count > 1) {
					    var msg = "There are "+count+" records in our genealogy for "+firstname+" "+lastname+" born in "+birthyear;
					    $("#family-info").empty().append("<div class='info-message'>"+msg+"</div>");
						$.each(parsedJson, function (codyid,personData) {
							loadPerson(personData,1);
						});

					}
					$("#searchbyname").prop('disabled',false)
				})
				.fail(function (jqXHR, textStatus, errorThrown) {
					$("#searchbyname").prop('disabled',false)
					$('#family-info').empty().append(errorThrown);
				})
		});
	});
</script>

<script type="text/javascript">
    /* Tally up the changed fields   */
    function compileChanges(uniqueid) {
		// Check for required fields
	    var submitterFirstName = $("#submitter-first-name"+uniqueid).val().trim();
	    var submitterLastName = $("#submitter-last-name"+uniqueid).val().trim();
	    var submitterCodyId = $("#submitter-cody-id"+uniqueid).val().trim();
	    var submitterEmail = $("#submitter-email"+uniqueid).val().trim();
		var submitterComment = $("#comment"+uniqueid).val().trim();

		if(submitterFirstName.length == 0 || submitterLastName.length == 0 || isEmail(submitterEmail) == false) {
		    $("#must-include-message"+uniqueid).css('color','red');
		    //alert("Please include first name, last name and a proper email address");
			return false;
		}

		// Saved original data sent to populate this form
		var originalData = JSON.parse(JSON.stringify($("#edit-window"+uniqueid).data()));

		// get form data
		var id = $("#edit-form"+uniqueid).prop('id');
		var $form = $("#edit-form"+uniqueid);

	    var serializedFormData = $form.serialize();   // Serialize the form inputs
		var submittedInputs = serializedFormData.split('&');
		var submittedData = {};
		var numberOfInputs = 0;

		console.log("submittedInputs = ", submittedInputs);
		$.each(submittedInputs, function(index,value) {
			  console.log("value = ", value);
		    var nameandvalue = value.split('=');
			var inputName = nameandvalue[0].replace(uniqueid,""); // remove id decoration
			var inputValue = nameandvalue[1];
			
			/* divorced */
			if(inputName.indexOf("submitter") == -1 && inputName.indexOf("comment") == -1) {
				submittedData[inputName] = inputValue.replace(/\+/g," ");
				numberOfInputs++;
			}
		});
		console.log("submittedData = ", submittedData)
		//**************************************************************//
		// CHECK FOR CHANGED FIELDS
		//**************************************************************//
        var changedFields = {};
		var numberOfChanges = 0;
		$.each(submittedData, function(submitIndex,submitValue) {
			//console.log(submitIndex+ " "+ submitValue);
			var submitLabel = submitIndex.replace(/\-/g," ");
			submitLabel = submitLabel.charAt(0).toUpperCase() + submitLabel.slice(1);
			var submitValueString = String(submitValue);
			var submitValueCleaned = submitValueString.replace(/\+/g,' ');

			if(submitIndex in originalData) {
				var originalValue = originalData[submitIndex];
				if(submitValueCleaned != originalValue) {
					changedFields[submitIndex] = submitValueCleaned;
					var $changeRow = $("<tr class='confirm-data-row'><td class='label-cell'>" + submitLabel +"</td><td class='original-data-cell'>"+originalValue+"</td><td class='submitted-data-cell'>"+submitValueCleaned+"</td></tr>");
					$("#confirm-table").append($changeRow);
					numberOfChanges++;
				}
			}
            else {
			    if(submitValueCleaned.length > 0) {
					var $changeRow = $("<tr class='confirm-data-row'><td class='label-cell'>" + submitLabel +"</td><td class='original-data-cell'></td><td class='submitted-data-cell'>"+submitValueCleaned+"</td></tr>");
					$("#confirm-table").append($changeRow);
					numberOfChanges++;
				}
			}
		});
		//**************************************************************//
		// If there are valid changes, show CONFIRM OVERLAY
		//**************************************************************//
		if(numberOfChanges > 0) {
			// Saved original data sent to populate this form
			var originalData = JSON.parse(JSON.stringify($("#edit-window"+uniqueid).data()));

		    var confirmTitle = "Suggested Corrections for Cody ID "+ $("#codyidspan"+uniqueid).html();
		    $("#confirm-title").html(confirmTitle);
			$("#confirm-first-name").html(submitterFirstName);
			$("#confirm-last-name").html(submitterLastName);
			$("#confirm-cody-id").html(submitterCodyId);
			$("#confirm-email").html(submitterEmail);
			if(submitterComment.length > 0) {
				$("#confirm-comment").html(submitterComment);
				$("#comment"+uniqueid).val('')
				$("#confirm-comment-container").show();
			}
			$("#unique-id").html(uniqueid);
			$("#original-data").data(originalData);
			$("#submitted-data").data(submittedData);
			$("#submit-confirm-overlay").show();
		}
		else {  alert("No changes were made");}
	}
</script>

<!-- This is the Submit Confirm modal dialog-->
<div id="submit-confirm-overlay">
    <div id="confirm-container">
		<div id="confirm-title" class="confirm-title"></div>
		<div id="submitter-info" class="confirm-title">
			From <span id="confirm-first-name"></span> <span id="confirm-last-name"></span> <span id="confirm-cody-id"></span>
			(<span id="confirm-email"></span>)
		</div>
		<table id="confirm-table" class="confirm">
			<tr id="confirm-header-row"><th>Item</th><th>Old value</th><th>Suggestion</th></tr>
		</table>
		<div id="confirm-comment-container">
			<div class="confirm-title">Comment</div>
			<div id="confirm-comment"></div>
		</div>

		<div id="unique-id" style="display:none"></div>
		<div id="original-data" style="display:none"></div>
		<div id="submitted-data" style="display:none"></div>
		<div id="confirm-buttons">
			<input type="button" id="submitconfirm" name="submitconfirm" class="button" value="Submit Changes" />
			<input type="button" id="cancelconfirm" name="cancelconfirm" class="button" value="Cancel Changes" />
		</div>

	</div>
</div>
<!-- END OF the Submit Confirm modal dialog-->

<script type="text/javascript">
	//**************************************************************//
	// Click events for SUBMIT CONFIRM OVERLAY
	//**************************************************************//
	$("#cancelconfirm").click(function(event) { $("#submit-confirm-overlay").hide();$("#confirm-table tr.confirm-data-row").remove();})

	$("#submitconfirm").click(function(event) {
	    var uniqueid =  $("#unique-id").html();
		var originalData = JSON.parse(JSON.stringify($("#original-data").data()));
		var submittedData = $("#submitted-data").data();
		console.log("submittedData = ", submittedData);
		var newRecordLine = "";
	    var confirmFirstName = $("#confirm-first-name").html();
	    var confirmLastName = $("#confirm-last-name").html();
	    var confirmCodyId = $("#confirm-cody-id").html();
	    var confirmEmail = $("#confirm-email").html();
	    var confirmComment = $("#confirm-comment").html();
		  $("#confirm-comment").html('');
	    var mailText = $("#confirm-title").html() + "\n\r";
		  mailText += $("#submitter-info").text() + "\n\r";

		  var senderdata = {'lastname':confirmFirstName,
												'firstname':confirmFirstName,
												'codyid':confirmCodyId,
												'email':confirmEmail};
		  console.log('sender data: ', senderdata);
		  $("#family-info").data('sender', senderdata);


		$("#confirm-table tr.confirm-data-row").each(function() {
			var $tr =  $(this);
            var label = $(this).find("td.label-cell").html();
            var originalDataCell = $(this).find("td.original-data-cell").html();
            var submittedDataCell = $(this).find("td.submitted-data-cell").html();
			var line = label + ":  Change " + originalDataCell + " to " + submittedDataCell + "\n";
			mailText += line;
		});
		mailText += "\n\rComment:  " + confirmComment;
		mailText += "\n\rOriginal Text Record:\n\r"+ originalData['line'] + "\n\r";
		$("#submit-confirm-overlay").hide();
		$("#confirm-table tr.confirm-data-row").remove();

		var newRecordLine = constructNewRecordLine(originalData, submittedData);
		mailText += "Updated Text Record:\n\r"+ newRecordLine + "\n\r";
		console.log(mailText);
		// SUBMIT CONFIRM
		submitConfirm(uniqueid, confirmFirstName, confirmLastName, confirmCodyId, confirmEmail, mailText);
	});
	//**************************************************************//
	// SEND MAIL
	//**************************************************************//
	function submitConfirm(uniqueid, firstname,lastname,codyid,email,suggestions, newRecordLine) {
		$.ajax( {url:'../cfo/pfd/swi.php',
				type: "POST",
				data: {action:'submitsuggestion',
					firstname: firstname,
					lastname: lastname,
					codyid: codyid,
					email: email,
					suggestions: suggestions,
					newrecordline: newRecordLine
				}
			})
			.done(function(data){
			    $("#edit-window"+uniqueid).remove();
                alert("Thank you for your suggestions, they will be review and, if valid, included in our next Genealogy.");
                var submitmessage = "Suggested corrections submitted by " + firstname  + " " + lastname + " - Thank you!";
				$("#searchbyname-message").html(submitmessage);
				location.reload();
			})
			.fail(function (jqXHR, textStatus, errorThrown) {

			})
	}
</script>
<script type="text/javascript">
	//**************************************************************//
	//     Contruct the record in the text file format
	//**************************************************************//
	function constructNewRecordLine(oldData, changedData) {
		var newData = oldData;
		var newRecordLine = newData['cody-id'];
		var numberOfMarriages = 0;
		// Merge
	    $.each( changedData, function( key, value ) {
		    //console.log(key + " " + value);
		    if(value.length > 0) {
				newData[key] = value;
			}

			if(key.includes("marriage-1")) { numberOfMarriages = 1;}
			if(key.includes("marriage-2")) { numberOfMarriages = 2;}
			if(key.includes("marriage-3")) { numberOfMarriages = 3;}
			if(key.includes("marriage-4")) { numberOfMarriages = 4;}
			if(key.includes("marriage-5")) { numberOfMarriages = 5;}
			if(key.includes("marriage-6")) { numberOfMarriages = 6;}
			if(key.includes("marriage-7")) { numberOfMarriages = 7;}
		});
		newData['number-of-marriages']	= numberOfMarriages;
		//console.log(newData);
		if('first-name' in newData) {newRecordLine += " " + newData['first-name'];}
		if('middle-name' in newData) {newRecordLine += " " + newData['middle-name'];}
		if('last-name' in newData) {newRecordLine += " " + newData['last-name'];}
		if('suffix' in newData) {newRecordLine += " " + newData['suffix'];}
        if('birth-day' in newData || 'birth-month' in newData || 'birth-year' in newData || 'birth-town' in newData || 'birth-region' in newData ) {
			newRecordLine += " b ";
			if('birth-town' in newData) {newRecordLine += " " + newData['birth-town'];}
			if('birth-region' in newData) {newRecordLine += " " + newData['birth-region'];}
			if('birth-month' in newData &&'birth-day' in newData && 'birth-year' in newData)	{
				newRecordLine +=  " " + newData['birth-month']+"/"+newData['birth-day']+"/"+newData['birth-year'];
			}
			else {
				if('birth-year' in newData) {newRecordLine += " " +  newData['birth-year'];}
			}
		}
        if('death-day' in newData || 'death-month' in newData || 'death-year' in newData || 'death-town' in newData || 'death-region' in newData ) {
			newRecordLine += " d ";
			if('death-town' in newData) {newRecordLine += " " + newData['death-town'];}
			if('death-region' in newData) {newRecordLine += " " + newData['death-region'];}
			if('death-month' in newData &&'death-day' in newData && 'death-year' in newData)	{
				newRecordLine += " " +  newData['death-month']+"/"+newData['death-day']+"/"+newData['death-year'];
			}
		}
        if('burial-town' in newData || 'burial-region' in newData) {
			newRecordLine += " bur ";
			if('burial-town' in newData) {newRecordLine += " " + newData['burial-town'];}
			if('burial-region' in newData) {newRecordLine += " " + newData['burial-region'];}
		}
		//**************************************************************//
		// May be new marriages added
		//**************************************************************//
		console.log("newData = ", newData);
		if(newData['number-of-marriages'] > 0) {

			for(var m=1; m <= newData['number-of-marriages']; m++) {
				newRecordLine += " m" + m + " ";

				if('marriage-'+m+'-wedding-town' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-wedding-town'] +
						 " ";
				}
				if('marriage-'+m+'-wedding-region' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-wedding-region'] +
						 ' ';
				}

				if('marriage-'+m+'-wedding-month' in newData &&
				   'marriage-'+m+'-wedding-day' in newData &&
				   'marriage-'+m+'-wedding-year' in newData)	{
					newRecordLine += newData['marriage-'+m+'-wedding-month']+
					"/"+
					newData['marriage-'+m+'-wedding-day']
					+"/"+
					newData['marriage-'+m+'-wedding-year'];
				}
				else {
					if('marriage-'+m+'-wedding-year' in newData) {
						newRecordLine += " " +
						     newData['marriage-'+m+'-wedding-year'];
						 }
				}

				if('marriage-'+m+'-first-name' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-first-name'];
				}
				if('marriage-'+m+'-middle-name' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-middle-name'];
				}
				if('marriage-'+m+'-last-name' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-last-name'];
				}
				if('marriage-'+m+'-suffix' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-suffix'];
				}
/*
				if('marriage-'+m+'-divorced' in newData) {
					newRecordLine += " div ";
				}
*/
				if('marriage-'+m+'-birth-day' in newData ||
				   'marriage-'+m+'-birth-month' in newData ||
				   'marriage-'+m+'-birth-year' in newData ||
				   'marriage-'+m+'-birth-town' in newData ||
				   'marriage-'+m+'-birth-region' in newData ) {

					newRecordLine += " b ";
					if('marriage-'+m+'-birth-town' in newData) {
						newRecordLine += " " +
						     newData['marriage-'+m+'-birth-town'];
					}
					if('marriage-'+m+'-birth-region' in newData) {
						newRecordLine += " " +
						newData['marriage-'+m+'-birth-region'];
					}

					if('marriage-'+m+'-birth-month' in newData &&
					   'marriage-'+m+'-birth-day' in newData &&
					   'marriage-'+m+'-birth-year' in newData)	{

						newRecordLine += " " +
						     newData['marriage-'+m+'-birth-month']+
							 "/"+
							 newData['marriage-'+m+'-birth-day']+
							 "/"+
							 newData['marriage-'+m+'-birth-year'];
					}
					else {
						if('marriage-'+m+'-birth-year' in newData) {
							newRecordLine += " " +
							newData['marriage-'+m+'-birth-year'];
						}
					}
				}
				if('marriage-'+m+'-death-day' in newData ||
				   'marriage-'+m+'-death-month' in newData ||
				   'marriage-'+m+'-death-year' in newData ||
				   'marriage-'+m+'-death-town' in newData ||
				   'marriage-'+m+'-death-region' in newData ) {

					newRecordLine += " d ";
					if('marriage-'+m+'-death-town' in newData) {
						newRecordLine += " " +
						     newData['marriage-'+m+'-death-town'];
					}
					if('marriage-'+m+'-death-region' in newData) {
						newRecordLine += " " +
						    newData['marriage-'+m+'-death-region'];
					}

					if('marriage-'+m+'-death-month' in newData &&
					   'marriage-'+m+'-death-day' in newData &&
					   'marriage-'+m+'-death-year' in newData)	{

					 	newRecordLine += " " +
						      newData['marriage-'+m+'-death-month']+
							  "/"+
							  newData['marriage-'+m+'-death-day']+
							  "/"+
							  newData['marriage-'+m+'-death-year'];
					}
					else {
						if('marriage-'+m+'-death-year' in newData) {
							newRecordLine += " " +
							     newData['marriage-'+m+'-death-year'];
						}
					}
				}

				if('marriage-'+m+'-burial-town' in newData ||
				   'marriage-'+m+'-burial-region' in newData) {

					newRecordLine += " bur ";
					if('marriage-'+m+'-burial-town' in newData) {
						newRecordLine += " " +
						     newData['marriage-'+m+'-burial-town'];
					}
					if('marriage-'+m+'-burial-region' in newData) {
						newRecordLine += " " +
						     newData['marriage-'+m+'-burial-region'];
					}

				}
				
        console.log("newData = ", newData);
				
				if('marriage-'+m+'-divorced' in newData) {
					console.log("recording a divorce");
					newRecordLine += " div ";
				}

			}
		}

	    return newRecordLine.replace(/\s\s+/g, ' ');
	}
</script>

<script type="text/javascript">
	function loadLineage(data) {
		$.each($.parseJSON(data), function (codyid, personData) {
		    loadPerson(personData,0);
		});
	}
</script>
<script type="text/javascript">
	//**************************************************************//
    // Dynamically construct the display of the person found
	//**************************************************************//
	function loadPerson(data, lineageOption) {

	    var prettyJSON = JSON.stringify(data,null,4);
		var codyid = data['cody-id'];
	    var uniqueid = "-"+data['chapter']+"-"+data['chapter-member-id'];
		var fullName = data['full-name'];
		var $personDiv = $('<div id="person'+uniqueid+'" class="person"></div>"');
		$("#family-info").append($personDiv);

		var bg = bgcolors[data['generation']];
		var marginLeft = (15 * data['generation']) - 75;
		$personDiv.css("margin-left",marginLeft).css("background-color",bg);
		var $detailDiv1 = $('<div class="person-row"></div>');
		$detailDiv1.append('<label  class="row-header">Cody ID</label><span id="codyid">'+data['cody-id']+':  '+data['full-name']+'</span>');
		$detailDiv1.append('<label>Generation</label>'+data['generation']);
		$detailDiv1.append('<input id="suggest'+uniqueid+'" type="button" class="button" style="margin-left: 50px;" value="Suggest a Correction" />');
        if(lineageOption == 1) {
			$detailDiv1.append('<input id="viewlineage'+uniqueid+'" type="button" class="button" style="margin-left: 25px;" value="View Lineage" />');
        }
		$personDiv.append($detailDiv1);
		var $bornDiv = $('<div class="person-row"></div>');
        if('birth-year' in data) {$bornDiv.append('<label class="row-header">Born</label>'+data['birth-month-name']+' '+data['birth-day']+', '+data['birth-year']);}
		if('birth-town' in data && 'birth-region' in data) {
			$bornDiv.append('<label>in</label>'+data['birth-town']+', '+data['birth-region']);
		}
		else if('birth-region' in data) {
			$bornDiv.append('<label>in</label>'+data['birth-region']);
		}

		else if('birth-place' in data) {
			if(data['birth-place'].length > 0){ $bornDiv.append('<label>Birth Place</label>'+data['birth-place']);}
		}
		$personDiv.append($bornDiv);
		if('death-info' in data || 'burial-info' in data) {

			var $deathRow = $('<div class="person-row"><label class="row-header">Died</label></div>');
			if('death-month-name' in data) {$deathRow.append(data['death-month-name']);}
			if('death-day' in data) {$deathRow.append(' '+data['death-day']);}
			if('death-year' in data) {$deathRow.append(' '+data['death-year']);}
			if('death-town' in data || 'death-region' in data) {
			    var dp = "<label> in </label>";
				if('death-town' in data) {dp += data['death-town']+" ";}
				if('death-region' in data) {dp += data['death-region'];}
				$deathRow.append(dp);
			}
		    if('burial-info' in data) {$deathRow.append('<label>Buried</label>'+data['burial-info']);}
		}

		$personDiv.append($deathRow);
		//**************************************************************//
	    // MARRIAGES
		//**************************************************************//
		if(data['number-of-marriages'] > 0) {
		    var $marDiv = $('<div class="person-row"></div');
		    if(data['number-of-marriages'] > 1) {
		        $marDiv.append('<label class="row-header">Marriages (' +data['number-of-marriages']+')</label>');
			}
			else {
		        $marDiv.append('<label>Marriage</label>');
			}

			for(var m=1;m<(data['number-of-marriages']+1);m++) {

			    var prefix = 'marriage-'+m+'-';

				var firstname="", middlename="",lastname="";

				if(prefix+'first-name' in data) {firstname = data[prefix+'first-name'];}
				if(prefix+'middle-name' in data) {middlename = data[prefix+'middle-name'];}
				if(prefix+'last-name' in data) {lastname = data[prefix+'last-name'];}
				var fullname = $.trim(firstname+' '+middlename+' '+lastname);
			    var $mar = $('<div class="marriage-row"></div>');
				$mar.append('<label class="row-header">'+m+'.</label>');
				if(prefix+'wedding-date' in data)  {
					$mar.append('<label class="row-header">Wedding</label> '+data[prefix+'wedding-month']+'-'+data[prefix+'wedding-day']+'-'+data[prefix+'wedding-year']);
				}
				if(prefix+'wedding-place' in data)  {
					$mar.append('<label class="row-header">in</label> '+data[prefix+'wedding-place']);
				}

				if(prefix+'spouse' in data) {$mar.append('<label>To</label> '+fullname); }
				if(prefix+'birth-date' in data) {$mar.append('<label>Born</label>'+data[prefix+'birth-month']+'-'+data[prefix+'birth-day']+'-'+data[prefix+'birth-year']); }
				if(prefix+'birth-town' in data && data[prefix+'birth-place'] != "") {$mar.append('<label>in</label>'  +data[prefix+'birth-place']); }
				if(prefix+'death-info' in data) {
					$mar.append('<label>Died</label>');
					if(prefix+'death-month' in data) {$mar.append(data[prefix+'death-month']);}
					if(prefix+'death-day' in data) {$mar.append("-"+data[prefix+'death-day']+"-");}
					if(prefix+'death-year' in data) {$mar.append(data[prefix+'death-year']);}

					if(prefix+'death-town' in data) { $mar.append(' '+data[prefix+'death-town']);}
					if(prefix+'death-region' in data) { $mar.append(' '+data[prefix+'death-region']);}
				}
				if(prefix+'burial-town' in data && prefix+'burial-region' in data) {
				    $mar.append('<label>Buried</label> '  +data[prefix+'burial-town']+', '+data[prefix+'burial-region']);
				}
				else if(prefix+'burial-info' in data) {$mar.append('<label>Buried</label> '  +data[prefix+'burial-info']); }
				if(prefix+'divorced' in data) {$mar.append('<label> (Divorced)</label>'); }
				$marDiv.append($mar);
			}
	        $personDiv.append($marDiv);
        }
		var $lineDiv = $('<div class="data-row"><label class="row-header">Record: </label>'+data['line']+'</div>');
		$personDiv.append($lineDiv);



		//****************************************************
		// This causes suggest button to construct edit window
		//   uniqueid identifies each separate node of the lineage
		//****************************************************
        var suggestid = '#suggest'+uniqueid;
		$(suggestid).click(function(event) {
		    if( $("#edit-window"+uniqueid).length) {$("#edit-window"+uniqueid).show(); return; }
		    var $editClone = $("#edit-window").clone();
			$editClone.attr("id","edit-window"+uniqueid);
			$editClone.find('[id]').each(function(){this.id+=uniqueid});
			$editClone.find('[name]').each(function(){this.name+=uniqueid});
			$editClone.data(data);    // Store the JSON in the edit window, to compare with form submission

		    $("#person"+uniqueid).after($editClone);
			  var sender = $("#family-info").data('sender');
				if (sender){
					// $("#family-info").data('sender', senderdata);
					/*
						  var senderdata = {'lastname:confirmFirstName,
												'firstname':confirmFirstName,
												'codyid':confirmCodyId,
												'email':confirmEmail};
					*/

	    		  $("#submitter-first-name"+uniqueid).val(sender['firstname']);
	    		  $("#submitter-last-name"+uniqueid).val(sender['lastname']);
	    		  $("#submitter-cody-id"+uniqueid).val(sender['codyid']);
	    		  $("#submitter-email"+uniqueid).val(sender['email']);

				}
			$editClone.width($("#person"+uniqueid).width());
			var mleft = $("#person"+uniqueid).css('margin-left');
			$editClone.css('margin-left',mleft);
			var bgColor = $("#person"+uniqueid).css('background-color');
			$editClone.css('background-color',bgColor);
			var firstname="", middlename="",lastname="";
			if('first-name' in data) {firstname = data['first-name'];}
			if('middle-name' in data) {middlename = data['middle-name'];}
			if('last-name' in data) {lastname = data['last-name'];}
			var fullname = $.trim(firstname+' '+middlename+' '+lastname);
			$("#codyidspan"+uniqueid).text(codyid+':  '+fullname);
			$("#first-name"+uniqueid).val(data['first-name']);
			if('middle-name' in data) {$("#middle-name"+uniqueid).val(data['middle-name']);}
			$("#last-name"+uniqueid).val(data['last-name']);
			$("#suffix"+uniqueid).val(data['suffix']);
			$("#birth-month"+uniqueid).val(data['birth-month']);
			$("#birth-day"+uniqueid).val(data['birth-day']);
			$("#birth-year"+uniqueid).val(data['birth-year']);
			$("#birth-town"+uniqueid).val(data['birth-town']).show();
			$("#birth-region"+uniqueid).val(data['birth-region']).show();

			if('death-info' in data) {
				$("#death-month"+uniqueid).val(data['death-month']);
				$("#death-day"+uniqueid).val(data['death-day']);
				$("#death-year"+uniqueid).val(data['death-year']);
				$("#death-town"+uniqueid).val(data['death-town']);
				$("#death-region"+uniqueid).val(data['death-region']);
			}
			if('burial-town' in data && 'burial-region' in data) {
				$("#burial-town"+uniqueid).val(data['burial-town']);
				$("#burial-region"+uniqueid).val(data['burial-region']);
			}
			else if('burial-info' in data) {
				$("#burial-town"+uniqueid).val(data['burial-info']);
			}
			// There may be 0 to 6 marriages
            if(data['number-of-marriages'] > 0) {

				$("#editmarriages"+uniqueid).show();

			    for(var m=1;m<(data['number-of-marriages']+1);m++) {

					//* Data fields for each marriage are prefixed by "marriage-1-", "marriage-2-", etc.
					var prefix = 'marriage-'+m+'-';

					//* Copy the template
					var $editMarDiv = $("#edit-marriage-table").clone();
					$editMarDiv.attr("id",prefix+"edit-marriage-table"+uniqueid);

					//* CustOmize the id and name for each input in the marriage editing block
					//* This in case of multiple edit windows open.
					//*  Too bad multiple edit windows are a bad idea.
					$editMarDiv.find('[id]').each(function(){this.id = prefix+this.id+uniqueid});
					$editMarDiv.find('[name]').each(function(){this.name = prefix+this.name+uniqueid});
					$editMarDiv.addClass("edit-marriage-table-active");
					$("#editmarriagescell"+uniqueid).append($editMarDiv);
					$editMarDiv.show();

					var firstname="", middlename="",lastname="";
					if(prefix+'first-name' in data) {firstname = data[prefix+'first-name'];}
					if(prefix+'middle-name' in data) {middlename = data[prefix+'middle-name'];}
					if(prefix+'last-name' in data) {lastname = data[prefix+'last-name'];}
                    var fullname = $.trim(firstname+' '+middlename+' '+lastname);
					if(data['number-of-marriages'] == 1) {
					    $("#"+prefix+"editmarriage-title-cell"+uniqueid).html("Marriage to "+fullname);
					}
					else {
					    var title = "Marriage "+m+" to "+fullname;
						$("#"+prefix+"editmarriage-title-cell"+uniqueid).html(title);
					}
					$("#"+prefix+"wedding-month"+uniqueid).val(data[prefix+'wedding-month']);
					$("#"+prefix+"wedding-day"+uniqueid).val(data[prefix+'wedding-day']);
					$("#"+prefix+"wedding-year"+uniqueid).val(data[prefix+'wedding-year']);
					$("#"+prefix+"wedding-town"+uniqueid).val(data[prefix+'wedding-town']);
					$("#"+prefix+"wedding-region"+uniqueid).val(data[prefix+'wedding-region']);
                    if(prefix+'divorced' in data) {
					     $("#"+prefix+"divorced"+uniqueid).prop( 'checked' , true );
						 $("#"+prefix+"divorced"+uniqueid).val('div');
					}
					$("#"+prefix+"divorced"+uniqueid).change(function() {
					    if($(this).is(":checked")) {$(this).val('divorced');}
						else {$(this).val('');}
					});

					if(prefix+'first-name' in data) {$("#"+prefix+"first-name"+uniqueid).val(data[prefix+'first-name']);	}
					if(prefix+'middle-name' in data) {$("#"+prefix+"middle-name"+uniqueid).val(data[prefix+'middle-name']);	}
					if(prefix+'last-name' in data) {$("#"+prefix+"last-name"+uniqueid).val(data[prefix+'last-name']); }
					if(prefix+'suffix' in data) {$("#"+prefix+"suffix"+uniqueid).val(data[prefix+'suffix']); }
					if(prefix+'birth-month' in data) {$("#"+prefix+"birth-month"+uniqueid).val(data[prefix+'birth-month']);	}
					if(prefix+'birth-day' in data) {$("#"+prefix+"birth-day"+uniqueid).val(data[prefix+'birth-day']);}
					if(prefix+'birth-year' in data) {$("#"+prefix+"birth-year"+uniqueid).val(data[prefix+'birth-year']);}
					if(prefix+'birth-town' in data) {$("#"+prefix+"birth-town"+uniqueid).val(data[prefix+'birth-town']);}
					if(prefix+'birth-region' in data) {$("#"+prefix+"birth-region"+uniqueid).val(data[prefix+'birth-region']);}
					if(prefix+'death-info' in data) {

						$("#"+prefix+"death-month"+uniqueid).val(data[prefix+'death-month']);
						$("#"+prefix+"death-day"+uniqueid).val(data[prefix+'death-day']);
						$("#"+prefix+"death-year"+uniqueid).val(data[prefix+'death-year']);
						$("#"+prefix+"death-town"+uniqueid).val(data[prefix+'death-town']);
						$("#"+prefix+"death-region"+uniqueid).val(data[prefix+'death-region']);
					}

					if(prefix+'burial-town' in data  && prefix+'burial-region' in data) {
						$("#"+prefix+"burial-town"+uniqueid).val(data[prefix+'burial-town']);
						$("#"+prefix+"burial-region"+uniqueid).val(data[prefix+'burial-region']);
					}
					else if(prefix+'burial-info' in data) {
						$("#"+prefix+"burial-town"+uniqueid).val(data[prefix+'burial-info']);

					}
				}
			}
			else {
				$("#editmarriages").hide();
			}
			$editClone.show();

			// BOUND FUNCTIONS for edit fields in template
			$('input.number').keydown(function(key) {
				if((key.keyCode >= 48 && key.keyCode <= 57) || key.keyCode == 8 || key.keyCode == 9 || key.keyCode == 46||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
				{ return true; }
				else { return false; }
			});
			$('input.number').blur(function() {
				var val = parseInt($(this).val());
				if(Number.isInteger(val)) {	$(this).val(val);	}
				else {	$(this).val("");}
			});
			$('input.name-or-place').keydown(function(key) {
			    console.log(key);
				if( (key.keyCode >= 97 && key.keyCode <= 122) ||
					(key.keyCode >= 65 && key.keyCode <= 90) ||
					key.keyCode == 189 || key.keyCode == 222 || key.keyCode == 8 || key.keyCode == 9 || key.keyCode == 46 || key.keyCode == 32||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
					{ return true; }
				else { return false; }
			});


			// CANCEL
			$("#editcancel"+uniqueid).click(function(event) {
				$("#edit-window"+uniqueid).remove();
				//$("#edit-window input:text").val("");
				$("#editmarriagecell"+uniqueid).empty();
			});

			// SUBMIT
			$("#edit-form"+uniqueid).submit(function(event) {
				event.preventDefault();
				deleteEmptyMarriage();
				compileChanges(uniqueid);
			});

			/**************************************************
							ADD A MARRIAGE
			*************************************************/
			$("#addamarriage"+uniqueid).on('click', function() {

				if(isLastMarriageValid()) {
					/* Make unique id for this edit marriage table when their are multiple marriages */
					/* Data fields for each marriage are prefixed by "marriage-1-", "marriage-2-", etc. */
					var newMarriageNumber = $(".edit-marriage-table-active").length + 1;
					var prefix = 'marriage-'+newMarriageNumber+'-';
					// Copy the template
					var $newMarDiv = $("#edit-marriage-table").clone();
					$newMarDiv.attr("id",prefix+"edit-marriage-table"+uniqueid);
					$newMarDiv.addClass("edit-marriage-table-active");
					// Customize the id and name for each input in the marriage editing block
					$newMarDiv.find('[id]').each(function(){this.id = prefix+this.id+uniqueid});
					$newMarDiv.find('[name]').each(function(){this.name = prefix+this.name+uniqueid});



					$("#editmarriagescell"+uniqueid).append($newMarDiv);

					// BOUND FUNCTIONS FOR ADD MARRIAGE
					$('input.number').keydown(function(key) {
						if((key.keyCode >= 48 && key.keyCode <= 57) || key.keyCode == 8 || key.keyCode == 9 || key.keyCode == 46 ||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
						{ return true; }
						else { return false; }
					});
					$('input.number').blur(function() {
						var val = parseInt($(this).val());
						if(Number.isInteger(val)) {	$(this).val(val);	}
						else {	$(this).val("");}
					});
					$('input.name-or-place').keydown(function(key) {
						if( (key.keyCode >= 97 && key.keyCode <= 122) ||
							(key.keyCode >= 65 && key.keyCode <= 90) ||
							key.keyCode == 189 || key.keyCode == 222 || key.keyCode == 8 || key.keyCode == 9 || key.keyCode == 46 || key.keyCode == 32 ||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
							{ return true; }
						else { return false; }
					});
					var newTitleCell = "#"+prefix+"editmarriage-title-cell"+uniqueid;
					$(newTitleCell).html("New Marriage Record");
					$newMarDiv.show();
				}
			});

		});
        if(lineageOption == 1) {
			var viewlineageid = '#viewlineage'+uniqueid;
			$(viewlineageid).click(function(event) {
			    $(viewlineageid).prop('disabled',true);
			    if($(viewlineageid).attr("value") == "View Lineage") {
					$.ajax( {url:'../cfo/pfd/swi.php',
							type: "POST",
							data: {action:'getlineage', codyid:codyid}
						})
						.done(function(data){
							$(viewlineageid).attr("value","Hide Lineage");
							loadLineage(data);

						})
						.fail(function (jqXHR, textStatus, errorThrown) {
							$('#family-info').empty().append("The Cody ID "+codyid+" was not found");
						});
				}
				else {
					$(viewlineageid).attr("value","View Lineage");
				    $("#family-info").children().slice(1).remove();
				}
			    $(viewlineageid).prop('disabled',false);

			});
        }
		//return $personDiv;
	}

	// end of loadPerson(data, lineageOption)
	//
</script>

<script type="text/javascript">
    //**************************************************************//
	//  This is to make sure empty marriage recordd aren't accidentally added.
	//  You can't add a marriage if the current edit window has a marriage
	//    record with no information in any field.
	//**************************************************************//
   function isLastMarriageValid() {
		var $marriageTables = $(".edit-marriage-table-active");
		if($marriageTables.length > 0) {
			var $lastMarriage = $marriageTables[$marriageTables.length-1];
			var allInputs = $($lastMarriage).find("input, select");
			var total = "";
			$.each(allInputs, function(i,field) {
				var id = $(field).attr('id');
				var val = $("#"+id).val();
				var type = $("#"+id).attr("type");
				if(type == "checkbox") {
					var checked = $("#"+id).is(":checked");
					if(checked) {  val = "div";	}
					else {		   val = "";	}
				}
				total += val;
			});
			//console.log("Total = " + total);
			if(total.length == 0) {	return false; }
			else { return true; }
		}
		else {   return true; }
   }


   //*************************************************************
   //       Does what it says on the tin
   //*************************************************************//
   function deleteEmptyMarriage() {
        if(!isLastMarriageValid()) {
			var $marriageTables = $(".edit-marriage-table-active");
			if($marriageTables.length > 0) {
				var $lastMarriage = $marriageTables[$marriageTables.length-1];
				$lastMarriage.remove();
			}
		}
   }
</script>

<script type="text/javascript">
$(document).ready(function() {
		$('input.number').keydown(function(key) {
			if((key.keyCode >= 48 && key.keyCode <= 57) || key.keyCode == 8 || key.keyCode == 9 || key.keyCode == 46||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
			{ return true; }
			else { return false; }
		});
		$('input.number').blur(function() {
			var val = parseInt($(this).val());
			if(Number.isInteger(val)) {	$(this).val(val);	}
			else {	$(this).val("");}
		});
		$('input.name-or-place').keydown(function(key) {
		    console.log(key.keyCode);
			if( (key.keyCode >= 97 && key.keyCode <= 122) ||
				(key.keyCode >= 65 && key.keyCode <= 90) ||
				key.keyCode == 189 || key.keyCode == 222 || key.keyCode == 8 || key.keyCode == 9 	|| key.keyCode == 46 || key.keyCode == 32 ||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
				{ return true; }
			else { return false; }
		});
<script type="text/javascript">
    /* Tally up the changed fields   */
    function compileChanges(uniqueid) {
		// Check for required fields
	    var submitterFirstName = $("#submitter-first-name"+uniqueid).val().trim();
	    var submitterLastName = $("#submitter-last-name"+uniqueid).val().trim();
	    var submitterCodyId = $("#submitter-cody-id"+uniqueid).val().trim();
	    var submitterEmail = $("#submitter-email"+uniqueid).val().trim();
		var submitterComment = $("#comment"+uniqueid).val().trim();

		if(submitterFirstName.length == 0 || submitterLastName.length == 0 || isEmail(submitterEmail) == false) {
		    $("#must-include-message"+uniqueid).css('color','red');
		    //alert("Please include first name, last name and a proper email address");
			return false;
		}

		// Saved original data sent to populate this form
		var originalData = JSON.parse(JSON.stringify($("#edit-window"+uniqueid).data()));

		// get form data
		var id = $("#edit-form"+uniqueid).prop('id');
		var $form = $("#edit-form"+uniqueid);

	    var serializedFormData = $form.serialize();   // Serialize the form inputs
		var submittedInputs = serializedFormData.split('&');
		var submittedData = {};
		var numberOfInputs = 0;

		console.log("submittedInputs = ", submittedInputs);
		$.each(submittedInputs, function(index,value) {
			  console.log("value = ", value);
		    var nameandvalue = value.split('=');
			var inputName = nameandvalue[0].replace(uniqueid,""); // remove id decoration
			var inputValue = nameandvalue[1];
			
			/* divorced */
			if(inputName.indexOf("submitter") == -1 && inputName.indexOf("comment") == -1) {
				submittedData[inputName] = inputValue.replace(/\+/g," ");
				numberOfInputs++;
			}
		});
		console.log("submittedData = ", submittedData)
		//**************************************************************//
		// CHECK FOR CHANGED FIELDS
		//**************************************************************//
        var changedFields = {};
		var numberOfChanges = 0;
		$.each(submittedData, function(submitIndex,submitValue) {
			//console.log(submitIndex+ " "+ submitValue);
			var submitLabel = submitIndex.replace(/\-/g," ");
			submitLabel = submitLabel.charAt(0).toUpperCase() + submitLabel.slice(1);
			var submitValueString = String(submitValue);
			var submitValueCleaned = submitValueString.replace(/\+/g,' ');

			if(submitIndex in originalData) {
				var originalValue = originalData[submitIndex];
				if(submitValueCleaned != originalValue) {
					changedFields[submitIndex] = submitValueCleaned;
					var $changeRow = $("<tr class='confirm-data-row'><td class='label-cell'>" + submitLabel +"</td><td class='original-data-cell'>"+originalValue+"</td><td class='submitted-data-cell'>"+submitValueCleaned+"</td></tr>");
					$("#confirm-table").append($changeRow);
					numberOfChanges++;
				}
			}
            else {
			    if(submitValueCleaned.length > 0) {
					var $changeRow = $("<tr class='confirm-data-row'><td class='label-cell'>" + submitLabel +"</td><td class='original-data-cell'></td><td class='submitted-data-cell'>"+submitValueCleaned+"</td></tr>");
					$("#confirm-table").append($changeRow);
					numberOfChanges++;
				}
			}
		});
		//**************************************************************//
		// If there are valid changes, show CONFIRM OVERLAY
		//**************************************************************//
		if(numberOfChanges > 0) {
			// Saved original data sent to populate this form
			var originalData = JSON.parse(JSON.stringify($("#edit-window"+uniqueid).data()));

		    var confirmTitle = "Suggested Corrections for Cody ID "+ $("#codyidspan"+uniqueid).html();
		    $("#confirm-title").html(confirmTitle);
			$("#confirm-first-name").html(submitterFirstName);
			$("#confirm-last-name").html(submitterLastName);
			$("#confirm-cody-id").html(submitterCodyId);
			$("#confirm-email").html(submitterEmail);
			if(submitterComment.length > 0) {
				$("#confirm-comment").html(submitterComment);
				$("#comment"+uniqueid).val('')
				$("#confirm-comment-container").show();
			}
			$("#unique-id").html(uniqueid);
			$("#original-data").data(originalData);
			$("#submitted-data").data(submittedData);
			$("#submit-confirm-overlay").show();
		}
		else {  alert("No changes were made");}
	}
</script>

<!-- This is the Submit Confirm modal dialog-->
<div id="submit-confirm-overlay">
    <div id="confirm-container">
		<div id="confirm-title" class="confirm-title"></div>
		<div id="submitter-info" class="confirm-title">
			From <span id="confirm-first-name"></span> <span id="confirm-last-name"></span> <span id="confirm-cody-id"></span>
			(<span id="confirm-email"></span>)
		</div>
		<table id="confirm-table" class="confirm">
			<tr id="confirm-header-row"><th>Item</th><th>Old value</th><th>Suggestion</th></tr>
		</table>
		<div id="confirm-comment-container">
			<div class="confirm-title">Comment</div>
			<div id="confirm-comment"></div>
		</div>

		<div id="unique-id" style="display:none"></div>
		<div id="original-data" style="display:none"></div>
		<div id="submitted-data" style="display:none"></div>
		<div id="confirm-buttons">
			<input type="button" id="submitconfirm" name="submitconfirm" class="button" value="Submit Changes" />
			<input type="button" id="cancelconfirm" name="cancelconfirm" class="button" value="Cancel Changes" />
		</div>

	</div>
</div>
<!-- END OF the Submit Confirm modal dialog-->

<script type="text/javascript">
	//**************************************************************//
	// Click events for SUBMIT CONFIRM OVERLAY
	//**************************************************************//
	$("#cancelconfirm").click(function(event) { $("#submit-confirm-overlay").hide();$("#confirm-table tr.confirm-data-row").remove();})

	$("#submitconfirm").click(function(event) {
	    var uniqueid =  $("#unique-id").html();
		var originalData = JSON.parse(JSON.stringify($("#original-data").data()));
		var submittedData = $("#submitted-data").data();
		console.log("submittedData = ", submittedData);
		var newRecordLine = "";
	    var confirmFirstName = $("#confirm-first-name").html();
	    var confirmLastName = $("#confirm-last-name").html();
	    var confirmCodyId = $("#confirm-cody-id").html();
	    var confirmEmail = $("#confirm-email").html();
	    var confirmComment = $("#confirm-comment").html();
		  $("#confirm-comment").html('');
	    var mailText = $("#confirm-title").html() + "\n\r";
		  mailText += $("#submitter-info").text() + "\n\r";

		  var senderdata = {'lastname':confirmFirstName,
												'firstname':confirmFirstName,
												'codyid':confirmCodyId,
												'email':confirmEmail};
		  console.log('sender data: ', senderdata);
		  $("#family-info").data('sender', senderdata);


		$("#confirm-table tr.confirm-data-row").each(function() {
			var $tr =  $(this);
            var label = $(this).find("td.label-cell").html();
            var originalDataCell = $(this).find("td.original-data-cell").html();
            var submittedDataCell = $(this).find("td.submitted-data-cell").html();
			var line = label + ":  Change " + originalDataCell + " to " + submittedDataCell + "\n";
			mailText += line;
		});
		mailText += "\n\rComment:  " + confirmComment;
		mailText += "\n\rOriginal Text Record:\n\r"+ originalData['line'] + "\n\r";
		$("#submit-confirm-overlay").hide();
		$("#confirm-table tr.confirm-data-row").remove();

		var newRecordLine = constructNewRecordLine(originalData, submittedData);
		mailText += "Updated Text Record:\n\r"+ newRecordLine + "\n\r";
		console.log(mailText);
		// SUBMIT CONFIRM
		submitConfirm(uniqueid, confirmFirstName, confirmLastName, confirmCodyId, confirmEmail, mailText);
	});
	//**************************************************************//
	// SEND MAIL
	//**************************************************************//
	function submitConfirm(uniqueid, firstname,lastname,codyid,email,suggestions, newRecordLine) {
		$.ajax( {url:'../cfo/pfd/swi.php',
				type: "POST",
				data: {action:'submitsuggestion',
					firstname: firstname,
					lastname: lastname,
					codyid: codyid,
					email: email,
					suggestions: suggestions,
					newrecordline: newRecordLine
				}
			})
			.done(function(data){
			    $("#edit-window"+uniqueid).remove();
                alert("Thank you for your suggestions, they will be review and, if valid, included in our next Genealogy.");
                var submitmessage = "Suggested corrections submitted by " + firstname  + " " + lastname + " - Thank you!";
				$("#searchbyname-message").html(submitmessage);
				location.reload();
			})
			.fail(function (jqXHR, textStatus, errorThrown) {

			})
	}
</script>
<script type="text/javascript">
	//**************************************************************//
	//     Contruct the record in the text file format
	//**************************************************************//
	function constructNewRecordLine(oldData, changedData) {
		var newData = oldData;
		var newRecordLine = newData['cody-id'];
		var numberOfMarriages = 0;
		// Merge
	    $.each( changedData, function( key, value ) {
		    //console.log(key + " " + value);
		    if(value.length > 0) {
				newData[key] = value;
			}

			if(key.includes("marriage-1")) { numberOfMarriages = 1;}
			if(key.includes("marriage-2")) { numberOfMarriages = 2;}
			if(key.includes("marriage-3")) { numberOfMarriages = 3;}
			if(key.includes("marriage-4")) { numberOfMarriages = 4;}
			if(key.includes("marriage-5")) { numberOfMarriages = 5;}
			if(key.includes("marriage-6")) { numberOfMarriages = 6;}
			if(key.includes("marriage-7")) { numberOfMarriages = 7;}
		});
		newData['number-of-marriages']	= numberOfMarriages;
		//console.log(newData);
		if('first-name' in newData) {newRecordLine += " " + newData['first-name'];}
		if('middle-name' in newData) {newRecordLine += " " + newData['middle-name'];}
		if('last-name' in newData) {newRecordLine += " " + newData['last-name'];}
		if('suffix' in newData) {newRecordLine += " " + newData['suffix'];}
        if('birth-day' in newData || 'birth-month' in newData || 'birth-year' in newData || 'birth-town' in newData || 'birth-region' in newData ) {
			newRecordLine += " b ";
			if('birth-town' in newData) {newRecordLine += " " + newData['birth-town'];}
			if('birth-region' in newData) {newRecordLine += " " + newData['birth-region'];}
			if('birth-month' in newData &&'birth-day' in newData && 'birth-year' in newData)	{
				newRecordLine +=  " " + newData['birth-month']+"/"+newData['birth-day']+"/"+newData['birth-year'];
			}
			else {
				if('birth-year' in newData) {newRecordLine += " " +  newData['birth-year'];}
			}
		}
        if('death-day' in newData || 'death-month' in newData || 'death-year' in newData || 'death-town' in newData || 'death-region' in newData ) {
			newRecordLine += " d ";
			if('death-town' in newData) {newRecordLine += " " + newData['death-town'];}
			if('death-region' in newData) {newRecordLine += " " + newData['death-region'];}
			if('death-month' in newData &&'death-day' in newData && 'death-year' in newData)	{
				newRecordLine += " " +  newData['death-month']+"/"+newData['death-day']+"/"+newData['death-year'];
			}
		}
        if('burial-town' in newData || 'burial-region' in newData) {
			newRecordLine += " bur ";
			if('burial-town' in newData) {newRecordLine += " " + newData['burial-town'];}
			if('burial-region' in newData) {newRecordLine += " " + newData['burial-region'];}
		}
		//**************************************************************//
		// May be new marriages added
		//**************************************************************//
		console.log("newData = ", newData);
		if(newData['number-of-marriages'] > 0) {

			for(var m=1; m <= newData['number-of-marriages']; m++) {
				newRecordLine += " m" + m + " ";

				if('marriage-'+m+'-wedding-town' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-wedding-town'] +
						 " ";
				}
				if('marriage-'+m+'-wedding-region' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-wedding-region'] +
						 ' ';
				}

				if('marriage-'+m+'-wedding-month' in newData &&
				   'marriage-'+m+'-wedding-day' in newData &&
				   'marriage-'+m+'-wedding-year' in newData)	{
					newRecordLine += newData['marriage-'+m+'-wedding-month']+
					"/"+
					newData['marriage-'+m+'-wedding-day']
					+"/"+
					newData['marriage-'+m+'-wedding-year'];
				}
				else {
					if('marriage-'+m+'-wedding-year' in newData) {
						newRecordLine += " " +
						     newData['marriage-'+m+'-wedding-year'];
						 }
				}

				if('marriage-'+m+'-first-name' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-first-name'];
				}
				if('marriage-'+m+'-middle-name' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-middle-name'];
				}
				if('marriage-'+m+'-last-name' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-last-name'];
				}
				if('marriage-'+m+'-suffix' in newData) {
					newRecordLine += " " +
					     newData['marriage-'+m+'-suffix'];
				}
/*
				if('marriage-'+m+'-divorced' in newData) {
					newRecordLine += " div ";
				}
*/
				if('marriage-'+m+'-birth-day' in newData ||
				   'marriage-'+m+'-birth-month' in newData ||
				   'marriage-'+m+'-birth-year' in newData ||
				   'marriage-'+m+'-birth-town' in newData ||
				   'marriage-'+m+'-birth-region' in newData ) {

					newRecordLine += " b ";
					if('marriage-'+m+'-birth-town' in newData) {
						newRecordLine += " " +
						     newData['marriage-'+m+'-birth-town'];
					}
					if('marriage-'+m+'-birth-region' in newData) {
						newRecordLine += " " +
						newData['marriage-'+m+'-birth-region'];
					}

					if('marriage-'+m+'-birth-month' in newData &&
					   'marriage-'+m+'-birth-day' in newData &&
					   'marriage-'+m+'-birth-year' in newData)	{

						newRecordLine += " " +
						     newData['marriage-'+m+'-birth-month']+
							 "/"+
							 newData['marriage-'+m+'-birth-day']+
							 "/"+
							 newData['marriage-'+m+'-birth-year'];
					}
					else {
						if('marriage-'+m+'-birth-year' in newData) {
							newRecordLine += " " +
							newData['marriage-'+m+'-birth-year'];
						}
					}
				}
				if('marriage-'+m+'-death-day' in newData ||
				   'marriage-'+m+'-death-month' in newData ||
				   'marriage-'+m+'-death-year' in newData ||
				   'marriage-'+m+'-death-town' in newData ||
				   'marriage-'+m+'-death-region' in newData ) {

					newRecordLine += " d ";
					if('marriage-'+m+'-death-town' in newData) {
						newRecordLine += " " +
						     newData['marriage-'+m+'-death-town'];
					}
					if('marriage-'+m+'-death-region' in newData) {
						newRecordLine += " " +
						    newData['marriage-'+m+'-death-region'];
					}

					if('marriage-'+m+'-death-month' in newData &&
					   'marriage-'+m+'-death-day' in newData &&
					   'marriage-'+m+'-death-year' in newData)	{

					 	newRecordLine += " " +
						      newData['marriage-'+m+'-death-month']+
							  "/"+
							  newData['marriage-'+m+'-death-day']+
							  "/"+
							  newData['marriage-'+m+'-death-year'];
					}
					else {
						if('marriage-'+m+'-death-year' in newData) {
							newRecordLine += " " +
							     newData['marriage-'+m+'-death-year'];
						}
					}
				}

				if('marriage-'+m+'-burial-town' in newData ||
				   'marriage-'+m+'-burial-region' in newData) {

					newRecordLine += " bur ";
					if('marriage-'+m+'-burial-town' in newData) {
						newRecordLine += " " +
						     newData['marriage-'+m+'-burial-town'];
					}
					if('marriage-'+m+'-burial-region' in newData) {
						newRecordLine += " " +
						     newData['marriage-'+m+'-burial-region'];
					}

				}
				
        console.log("newData = ", newData);
				
				if('marriage-'+m+'-divorced' in newData) {
					console.log("recording a divorce");
					newRecordLine += " div ";
				}

			}
		}

	    return newRecordLine.replace(/\s\s+/g, ' ');
	}
</script>

<script type="text/javascript">
	function loadLineage(data) {
		$.each($.parseJSON(data), function (codyid, personData) {
		    loadPerson(personData,0);
		});
	}
</script>
<script type="text/javascript">
	//**************************************************************//
    // Dynamically construct the display of the person found
	//**************************************************************//
	function loadPerson(data, lineageOption) {

	    var prettyJSON = JSON.stringify(data,null,4);
		var codyid = data['cody-id'];
	    var uniqueid = "-"+data['chapter']+"-"+data['chapter-member-id'];
		var fullName = data['full-name'];
		var $personDiv = $('<div id="person'+uniqueid+'" class="person"></div>"');
		$("#family-info").append($personDiv);

		var bg = bgcolors[data['generation']];
		var marginLeft = (15 * data['generation']) - 75;
		$personDiv.css("margin-left",marginLeft).css("background-color",bg);
		var $detailDiv1 = $('<div class="person-row"></div>');
		$detailDiv1.append('<label  class="row-header">Cody ID</label><span id="codyid">'+data['cody-id']+':  '+data['full-name']+'</span>');
		$detailDiv1.append('<label>Generation</label>'+data['generation']);
		$detailDiv1.append('<input id="suggest'+uniqueid+'" type="button" class="button" style="margin-left: 50px;" value="Suggest a Correction" />');
        if(lineageOption == 1) {
			$detailDiv1.append('<input id="viewlineage'+uniqueid+'" type="button" class="button" style="margin-left: 25px;" value="View Lineage" />');
        }
		$personDiv.append($detailDiv1);
		var $bornDiv = $('<div class="person-row"></div>');
        if('birth-year' in data) {$bornDiv.append('<label class="row-header">Born</label>'+data['birth-month-name']+' '+data['birth-day']+', '+data['birth-year']);}
		if('birth-town' in data && 'birth-region' in data) {
			$bornDiv.append('<label>in</label>'+data['birth-town']+', '+data['birth-region']);
		}
		else if('birth-region' in data) {
			$bornDiv.append('<label>in</label>'+data['birth-region']);
		}

		else if('birth-place' in data) {
			if(data['birth-place'].length > 0){ $bornDiv.append('<label>Birth Place</label>'+data['birth-place']);}
		}
		$personDiv.append($bornDiv);
		if('death-info' in data || 'burial-info' in data) {

			var $deathRow = $('<div class="person-row"><label class="row-header">Died</label></div>');
			if('death-month-name' in data) {$deathRow.append(data['death-month-name']);}
			if('death-day' in data) {$deathRow.append(' '+data['death-day']);}
			if('death-year' in data) {$deathRow.append(' '+data['death-year']);}
			if('death-town' in data || 'death-region' in data) {
			    var dp = "<label> in </label>";
				if('death-town' in data) {dp += data['death-town']+" ";}
				if('death-region' in data) {dp += data['death-region'];}
				$deathRow.append(dp);
			}
		    if('burial-info' in data) {$deathRow.append('<label>Buried</label>'+data['burial-info']);}
		}

		$personDiv.append($deathRow);
		//**************************************************************//
	    // MARRIAGES
		//**************************************************************//
		if(data['number-of-marriages'] > 0) {
		    var $marDiv = $('<div class="person-row"></div');
		    if(data['number-of-marriages'] > 1) {
		        $marDiv.append('<label class="row-header">Marriages (' +data['number-of-marriages']+')</label>');
			}
			else {
		        $marDiv.append('<label>Marriage</label>');
			}

			for(var m=1;m<(data['number-of-marriages']+1);m++) {

			    var prefix = 'marriage-'+m+'-';

				var firstname="", middlename="",lastname="";

				if(prefix+'first-name' in data) {firstname = data[prefix+'first-name'];}
				if(prefix+'middle-name' in data) {middlename = data[prefix+'middle-name'];}
				if(prefix+'last-name' in data) {lastname = data[prefix+'last-name'];}
				var fullname = $.trim(firstname+' '+middlename+' '+lastname);
			    var $mar = $('<div class="marriage-row"></div>');
				$mar.append('<label class="row-header">'+m+'.</label>');
				if(prefix+'wedding-date' in data)  {
					$mar.append('<label class="row-header">Wedding</label> '+data[prefix+'wedding-month']+'-'+data[prefix+'wedding-day']+'-'+data[prefix+'wedding-year']);
				}
				if(prefix+'wedding-place' in data)  {
					$mar.append('<label class="row-header">in</label> '+data[prefix+'wedding-place']);
				}

				if(prefix+'spouse' in data) {$mar.append('<label>To</label> '+fullname); }
				if(prefix+'birth-date' in data) {$mar.append('<label>Born</label>'+data[prefix+'birth-month']+'-'+data[prefix+'birth-day']+'-'+data[prefix+'birth-year']); }
				if(prefix+'birth-town' in data && data[prefix+'birth-place'] != "") {$mar.append('<label>in</label>'  +data[prefix+'birth-place']); }
				if(prefix+'death-info' in data) {
					$mar.append('<label>Died</label>');
					if(prefix+'death-month' in data) {$mar.append(data[prefix+'death-month']);}
					if(prefix+'death-day' in data) {$mar.append("-"+data[prefix+'death-day']+"-");}
					if(prefix+'death-year' in data) {$mar.append(data[prefix+'death-year']);}

					if(prefix+'death-town' in data) { $mar.append(' '+data[prefix+'death-town']);}
					if(prefix+'death-region' in data) { $mar.append(' '+data[prefix+'death-region']);}
				}
				if(prefix+'burial-town' in data && prefix+'burial-region' in data) {
				    $mar.append('<label>Buried</label> '  +data[prefix+'burial-town']+', '+data[prefix+'burial-region']);
				}
				else if(prefix+'burial-info' in data) {$mar.append('<label>Buried</label> '  +data[prefix+'burial-info']); }
				if(prefix+'divorced' in data) {$mar.append('<label> (Divorced)</label>'); }
				$marDiv.append($mar);
			}
	        $personDiv.append($marDiv);
        }
		var $lineDiv = $('<div class="data-row"><label class="row-header">Record: </label>'+data['line']+'</div>');
		$personDiv.append($lineDiv);



		//****************************************************
		// This causes suggest button to construct edit window
		//   uniqueid identifies each separate node of the lineage
		//****************************************************
        var suggestid = '#suggest'+uniqueid;
		$(suggestid).click(function(event) {
		    if( $("#edit-window"+uniqueid).length) {$("#edit-window"+uniqueid).show(); return; }
		    var $editClone = $("#edit-window").clone();
			$editClone.attr("id","edit-window"+uniqueid);
			$editClone.find('[id]').each(function(){this.id+=uniqueid});
			$editClone.find('[name]').each(function(){this.name+=uniqueid});
			$editClone.data(data);    // Store the JSON in the edit window, to compare with form submission

		    $("#person"+uniqueid).after($editClone);
			  var sender = $("#family-info").data('sender');
				if (sender){
					// $("#family-info").data('sender', senderdata);
					/*
						  var senderdata = {'lastname:confirmFirstName,
												'firstname':confirmFirstName,
												'codyid':confirmCodyId,
												'email':confirmEmail};
					*/

	    		  $("#submitter-first-name"+uniqueid).val(sender['firstname']);
	    		  $("#submitter-last-name"+uniqueid).val(sender['lastname']);
	    		  $("#submitter-cody-id"+uniqueid).val(sender['codyid']);
	    		  $("#submitter-email"+uniqueid).val(sender['email']);

				}
			$editClone.width($("#person"+uniqueid).width());
			var mleft = $("#person"+uniqueid).css('margin-left');
			$editClone.css('margin-left',mleft);
			var bgColor = $("#person"+uniqueid).css('background-color');
			$editClone.css('background-color',bgColor);
			var firstname="", middlename="",lastname="";
			if('first-name' in data) {firstname = data['first-name'];}
			if('middle-name' in data) {middlename = data['middle-name'];}
			if('last-name' in data) {lastname = data['last-name'];}
			var fullname = $.trim(firstname+' '+middlename+' '+lastname);
			$("#codyidspan"+uniqueid).text(codyid+':  '+fullname);
			$("#first-name"+uniqueid).val(data['first-name']);
			if('middle-name' in data) {$("#middle-name"+uniqueid).val(data['middle-name']);}
			$("#last-name"+uniqueid).val(data['last-name']);
			$("#suffix"+uniqueid).val(data['suffix']);
			$("#birth-month"+uniqueid).val(data['birth-month']);
			$("#birth-day"+uniqueid).val(data['birth-day']);
			$("#birth-year"+uniqueid).val(data['birth-year']);
			$("#birth-town"+uniqueid).val(data['birth-town']).show();
			$("#birth-region"+uniqueid).val(data['birth-region']).show();

			if('death-info' in data) {
				$("#death-month"+uniqueid).val(data['death-month']);
				$("#death-day"+uniqueid).val(data['death-day']);
				$("#death-year"+uniqueid).val(data['death-year']);
				$("#death-town"+uniqueid).val(data['death-town']);
				$("#death-region"+uniqueid).val(data['death-region']);
			}
			if('burial-town' in data && 'burial-region' in data) {
				$("#burial-town"+uniqueid).val(data['burial-town']);
				$("#burial-region"+uniqueid).val(data['burial-region']);
			}
			else if('burial-info' in data) {
				$("#burial-town"+uniqueid).val(data['burial-info']);
			}
			// There may be 0 to 6 marriages
            if(data['number-of-marriages'] > 0) {

				$("#editmarriages"+uniqueid).show();

			    for(var m=1;m<(data['number-of-marriages']+1);m++) {

					//* Data fields for each marriage are prefixed by "marriage-1-", "marriage-2-", etc.
					var prefix = 'marriage-'+m+'-';

					//* Copy the template
					var $editMarDiv = $("#edit-marriage-table").clone();
					$editMarDiv.attr("id",prefix+"edit-marriage-table"+uniqueid);

					//* CustOmize the id and name for each input in the marriage editing block
					//* This in case of multiple edit windows open.
					//*  Too bad multiple edit windows are a bad idea.
					$editMarDiv.find('[id]').each(function(){this.id = prefix+this.id+uniqueid});
					$editMarDiv.find('[name]').each(function(){this.name = prefix+this.name+uniqueid});
					$editMarDiv.addClass("edit-marriage-table-active");
					$("#editmarriagescell"+uniqueid).append($editMarDiv);
					$editMarDiv.show();

					var firstname="", middlename="",lastname="";
					if(prefix+'first-name' in data) {firstname = data[prefix+'first-name'];}
					if(prefix+'middle-name' in data) {middlename = data[prefix+'middle-name'];}
					if(prefix+'last-name' in data) {lastname = data[prefix+'last-name'];}
                    var fullname = $.trim(firstname+' '+middlename+' '+lastname);
					if(data['number-of-marriages'] == 1) {
					    $("#"+prefix+"editmarriage-title-cell"+uniqueid).html("Marriage to "+fullname);
					}
					else {
					    var title = "Marriage "+m+" to "+fullname;
						$("#"+prefix+"editmarriage-title-cell"+uniqueid).html(title);
					}
					$("#"+prefix+"wedding-month"+uniqueid).val(data[prefix+'wedding-month']);
					$("#"+prefix+"wedding-day"+uniqueid).val(data[prefix+'wedding-day']);
					$("#"+prefix+"wedding-year"+uniqueid).val(data[prefix+'wedding-year']);
					$("#"+prefix+"wedding-town"+uniqueid).val(data[prefix+'wedding-town']);
					$("#"+prefix+"wedding-region"+uniqueid).val(data[prefix+'wedding-region']);
                    if(prefix+'divorced' in data) {
					     $("#"+prefix+"divorced"+uniqueid).prop( 'checked' , true );
						 $("#"+prefix+"divorced"+uniqueid).val('div');
					}
					$("#"+prefix+"divorced"+uniqueid).change(function() {
					    if($(this).is(":checked")) {$(this).val('divorced');}
						else {$(this).val('');}
					});

					if(prefix+'first-name' in data) {$("#"+prefix+"first-name"+uniqueid).val(data[prefix+'first-name']);	}
					if(prefix+'middle-name' in data) {$("#"+prefix+"middle-name"+uniqueid).val(data[prefix+'middle-name']);	}
					if(prefix+'last-name' in data) {$("#"+prefix+"last-name"+uniqueid).val(data[prefix+'last-name']); }
					if(prefix+'suffix' in data) {$("#"+prefix+"suffix"+uniqueid).val(data[prefix+'suffix']); }
					if(prefix+'birth-month' in data) {$("#"+prefix+"birth-month"+uniqueid).val(data[prefix+'birth-month']);	}
					if(prefix+'birth-day' in data) {$("#"+prefix+"birth-day"+uniqueid).val(data[prefix+'birth-day']);}
					if(prefix+'birth-year' in data) {$("#"+prefix+"birth-year"+uniqueid).val(data[prefix+'birth-year']);}
					if(prefix+'birth-town' in data) {$("#"+prefix+"birth-town"+uniqueid).val(data[prefix+'birth-town']);}
					if(prefix+'birth-region' in data) {$("#"+prefix+"birth-region"+uniqueid).val(data[prefix+'birth-region']);}
					if(prefix+'death-info' in data) {

						$("#"+prefix+"death-month"+uniqueid).val(data[prefix+'death-month']);
						$("#"+prefix+"death-day"+uniqueid).val(data[prefix+'death-day']);
						$("#"+prefix+"death-year"+uniqueid).val(data[prefix+'death-year']);
						$("#"+prefix+"death-town"+uniqueid).val(data[prefix+'death-town']);
						$("#"+prefix+"death-region"+uniqueid).val(data[prefix+'death-region']);
					}

					if(prefix+'burial-town' in data  && prefix+'burial-region' in data) {
						$("#"+prefix+"burial-town"+uniqueid).val(data[prefix+'burial-town']);
						$("#"+prefix+"burial-region"+uniqueid).val(data[prefix+'burial-region']);
					}
					else if(prefix+'burial-info' in data) {
						$("#"+prefix+"burial-town"+uniqueid).val(data[prefix+'burial-info']);

					}
				}
			}
			else {
				$("#editmarriages").hide();
			}
			$editClone.show();

			// BOUND FUNCTIONS for edit fields in template
			$('input.number').keydown(function(key) {
				if((key.keyCode >= 48 && key.keyCode <= 57) || key.keyCode == 8 || key.keyCode == 9 || key.keyCode == 46||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
				{ return true; }
				else { return false; }
			});
			$('input.number').blur(function() {
				var val = parseInt($(this).val());
				if(Number.isInteger(val)) {	$(this).val(val);	}
				else {	$(this).val("");}
			});
			$('input.name-or-place').keydown(function(key) {
			    console.log(key);
				if( (key.keyCode >= 97 && key.keyCode <= 122) ||
					(key.keyCode >= 65 && key.keyCode <= 90) ||
					key.keyCode == 189 || key.keyCode == 222 || key.keyCode == 8 || key.keyCode == 9 || key.keyCode == 46 || key.keyCode == 32||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
					{ return true; }
				else { return false; }
			});


			// CANCEL
			$("#editcancel"+uniqueid).click(function(event) {
				$("#edit-window"+uniqueid).remove();
				//$("#edit-window input:text").val("");
				$("#editmarriagecell"+uniqueid).empty();
			});

			// SUBMIT
			$("#edit-form"+uniqueid).submit(function(event) {
				event.preventDefault();
				deleteEmptyMarriage();
				compileChanges(uniqueid);
			});

			/**************************************************
							ADD A MARRIAGE
			*************************************************/
			$("#addamarriage"+uniqueid).on('click', function() {

				if(isLastMarriageValid()) {
					/* Make unique id for this edit marriage table when their are multiple marriages */
					/* Data fields for each marriage are prefixed by "marriage-1-", "marriage-2-", etc. */
					var newMarriageNumber = $(".edit-marriage-table-active").length + 1;
					var prefix = 'marriage-'+newMarriageNumber+'-';
					// Copy the template
					var $newMarDiv = $("#edit-marriage-table").clone();
					$newMarDiv.attr("id",prefix+"edit-marriage-table"+uniqueid);
					$newMarDiv.addClass("edit-marriage-table-active");
					// Customize the id and name for each input in the marriage editing block
					$newMarDiv.find('[id]').each(function(){this.id = prefix+this.id+uniqueid});
					$newMarDiv.find('[name]').each(function(){this.name = prefix+this.name+uniqueid});



					$("#editmarriagescell"+uniqueid).append($newMarDiv);

					// BOUND FUNCTIONS FOR ADD MARRIAGE
					$('input.number').keydown(function(key) {
						if((key.keyCode >= 48 && key.keyCode <= 57) || key.keyCode == 8 || key.keyCode == 9 || key.keyCode == 46 ||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
						{ return true; }
						else { return false; }
					});
					$('input.number').blur(function() {
						var val = parseInt($(this).val());
						if(Number.isInteger(val)) {	$(this).val(val);	}
						else {	$(this).val("");}
					});
					$('input.name-or-place').keydown(function(key) {
						if( (key.keyCode >= 97 && key.keyCode <= 122) ||
							(key.keyCode >= 65 && key.keyCode <= 90) ||
							key.keyCode == 189 || key.keyCode == 222 || key.keyCode == 8 || key.keyCode == 9 || key.keyCode == 46 || key.keyCode == 32 ||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
							{ return true; }
						else { return false; }
					});
					var newTitleCell = "#"+prefix+"editmarriage-title-cell"+uniqueid;
					$(newTitleCell).html("New Marriage Record");
					$newMarDiv.show();
				}
			});

		});
        if(lineageOption == 1) {
			var viewlineageid = '#viewlineage'+uniqueid;
			$(viewlineageid).click(function(event) {
			    $(viewlineageid).prop('disabled',true);
			    if($(viewlineageid).attr("value") == "View Lineage") {
					$.ajax( {url:'../cfo/pfd/swi.php',
							type: "POST",
							data: {action:'getlineage', codyid:codyid}
						})
						.done(function(data){
							$(viewlineageid).attr("value","Hide Lineage");
							loadLineage(data);

						})
						.fail(function (jqXHR, textStatus, errorThrown) {
							$('#family-info').empty().append("The Cody ID "+codyid+" was not found");
						});
				}
				else {
					$(viewlineageid).attr("value","View Lineage");
				    $("#family-info").children().slice(1).remove();
				}
			    $(viewlineageid).prop('disabled',false);

			});
        }
		//return $personDiv;
	}

	// end of loadPerson(data, lineageOption)
	//
</script>

<script type="text/javascript">
    //**************************************************************//
	//  This is to make sure empty marriage recordd aren't accidentally added.
	//  You can't add a marriage if the current edit window has a marriage
	//    record with no information in any field.
	//**************************************************************//
   function isLastMarriageValid() {
		var $marriageTables = $(".edit-marriage-table-active");
		if($marriageTables.length > 0) {
			var $lastMarriage = $marriageTables[$marriageTables.length-1];
			var allInputs = $($lastMarriage).find("input, select");
			var total = "";
			$.each(allInputs, function(i,field) {
				var id = $(field).attr('id');
				var val = $("#"+id).val();
				var type = $("#"+id).attr("type");
				if(type == "checkbox") {
					var checked = $("#"+id).is(":checked");
					if(checked) {  val = "div";	}
					else {		   val = "";	}
				}
				total += val;
			});
			//console.log("Total = " + total);
			if(total.length == 0) {	return false; }
			else { return true; }
		}
		else {   return true; }
   }


   //*************************************************************
   //       Does what it says on the tin
   //*************************************************************//
   function deleteEmptyMarriage() {
        if(!isLastMarriageValid()) {
			var $marriageTables = $(".edit-marriage-table-active");
			if($marriageTables.length > 0) {
				var $lastMarriage = $marriageTables[$marriageTables.length-1];
				$lastMarriage.remove();
			}
		}
   }
</script>

<script type="text/javascript">
$(document).ready(function() {
		$('input.number').keydown(function(key) {
			if((key.keyCode >= 48 && key.keyCode <= 57) || key.keyCode == 8 || key.keyCode == 9 || key.keyCode == 46||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
			{ return true; }
			else { return false; }
		});
		$('input.number').blur(function() {
			var val = parseInt($(this).val());
			if(Number.isInteger(val)) {	$(this).val(val);	}
			else {	$(this).val("");}
		});
		$('input.name-or-place').keydown(function(key) {
		    console.log(key.keyCode);
			if( (key.keyCode >= 97 && key.keyCode <= 122) ||
				(key.keyCode >= 65 && key.keyCode <= 90) ||
				key.keyCode == 189 || key.keyCode == 222 || key.keyCode == 8 || key.keyCode == 9 	|| key.keyCode == 46 || key.keyCode == 32 ||
						 key.keyCode == 37 || key.keyCode == 38 || key.keyCode == 39 || key.keyCode == 40)
				{ return true; }
			else { return false; }
		});

});
</scrip
});
</script>

</body>
</html>
